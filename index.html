
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>专驻转拽转 转拽 砖 砖专</title>
    
    <!-- Core Libraries (UMD) - Loaded before the script -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            overflow-x: hidden;
            touch-action: manipulation;
            background: linear-gradient(to bottom right, #e0e7ff, #f3e8ff);
            min-height: 100vh;
            margin: 0;
        }
        * {
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .helper-table td, .helper-table th {
            padding: 4px;
            border: 1px solid #e2e8f0;
            text-align: center;
            font-size: 0.7rem;
        }
        @media (min-width: 640px) {
            .helper-table td, .helper-table th { padding: 8px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const GameState = { START: 'START', PLAYING: 'PLAYING', SUMMARY: 'SUMMARY' };
        const GameMode = { TIMED: 'TIMED', RELAXED: 'RELAXED' };
        const DifficultyLevel = { BASIC: 'BASIC', ADVANCED: 'ADVANCED' };

        const generateQuestion = (level = DifficultyLevel.BASIC) => {
          const isMultiplication = Math.random() > 0.5;
          let n1, n2, ansValue, operation;
          if (isMultiplication) {
            n1 = Math.floor(Math.random() * 9) + 2;
            n2 = Math.floor(Math.random() * 9) + 2;
            ansValue = n1 * n2;
            operation = 'x';
          } else {
            const f1 = Math.floor(Math.random() * 9) + 2;
            const f2 = Math.floor(Math.random() * 9) + 2;
            ansValue = f2;
            n1 = f1 * f2;
            n2 = f1;
            operation = '梅';
          }
          let missingPart = 'result';
          let correctAnswer = ansValue;
          if (level === DifficultyLevel.ADVANCED) {
            const r = Math.random();
            if (r < 0.33) { missingPart = 'num1'; correctAnswer = n1; }
            else if (r < 0.66) { missingPart = 'num2'; correctAnswer = n2; }
          }
          const options = new Set([correctAnswer]);
          while (options.size < 4) {
            const fake = Math.abs(correctAnswer + (Math.floor(Math.random() * 5) + 1) * (Math.random() > 0.5 ? 1 : -1));
            if (fake !== correctAnswer && fake > 0) options.add(fake);
          }
          return {
            num1: missingPart === 'num1' ? '?' : n1,
            num2: missingPart === 'num2' ? '?' : n2,
            result: missingPart === 'result' ? '?' : (isMultiplication ? n1*n2 : n1/n2),
            operation,
            answer: correctAnswer,
            options: Array.from(options).sort((a, b) => a - b),
            missingPart,
            startTime: Date.now()
          };
        };

        const FeedbackBubble = ({ type, message }) => (
          <div className={`mt-4 p-4 rounded-xl border-2 ${type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-orange-100 border-orange-400 text-orange-700'} flex items-center gap-3 animate-bounce`}>
            <span className="text-2xl">{type === 'success' ? '' : ''}</span>
            <p className="font-bold text-lg">{message}</p>
          </div>
        );

        const App = () => {
          const [gameState, setGameState] = useState(GameState.START);
          const [gameMode, setGameMode] = useState(GameMode.TIMED);
          const [level, setLevel] = useState(DifficultyLevel.BASIC);
          const [currentQuestion, setCurrentQuestion] = useState(null);
          const [stats, setStats] = useState({ score: 0, streak: 0, totalAnswered: 0, correctAnswers: 0 });
          const [feedback, setFeedback] = useState(null);
          const [timer, setTimer] = useState(60);
          const [isPaused, setIsPaused] = useState(false);
          const [showHelper, setShowHelper] = useState(false);

          const startNewGame = (mode, lvl) => {
            setStats({ score: 0, streak: 0, totalAnswered: 0, correctAnswers: 0 });
            setGameMode(mode);
            setLevel(lvl);
            setGameState(GameState.PLAYING);
            setTimer(60);
            setFeedback(null);
            setIsPaused(false);
            setCurrentQuestion(generateQuestion(lvl));
          };

          useEffect(() => {
            let interval;
            if (gameState === GameState.PLAYING && gameMode === GameMode.TIMED && timer > 0 && !isPaused) {
              interval = setInterval(() => setTimer(t => t - 1), 1000);
            } else if (timer === 0 && gameState === GameState.PLAYING && gameMode === GameMode.TIMED) {
              setGameState(GameState.SUMMARY);
            }
            return () => clearInterval(interval);
          }, [gameState, timer, isPaused, gameMode]);

          const handleAnswer = (choice) => {
            if (!currentQuestion || feedback) return;
            const isCorrect = choice === currentQuestion.answer;
            
            setStats(prev => ({
              ...prev,
              totalAnswered: prev.totalAnswered + 1,
              correctAnswers: isCorrect ? prev.correctAnswers + 1 : prev.correctAnswers,
              streak: isCorrect ? prev.streak + 1 : 0,
              score: isCorrect ? prev.score + (10 * (prev.streak + 1)) : prev.score,
            }));

            if (isCorrect) {
              setFeedback({ type: 'success', message: " ! 转砖 !" });
              setTimeout(() => {
                setFeedback(null);
                setCurrentQuestion(generateQuestion(level));
              }, 1000);
            } else {
              setIsPaused(true);
              setFeedback({ type: 'error', message: ` 专! 转砖  ${currentQuestion.answer}.` });
            }
          };

          return (
            <div className="p-4 md:p-8 flex flex-col items-center justify-center min-h-screen">
              <div className={`${showHelper ? 'max-w-4xl' : 'max-w-xl'} w-full bg-white rounded-3xl shadow-2xl p-6 md:p-10 border-4 border-indigo-200 relative transition-all duration-500`}>
                {gameState === GameState.START && (
                  <div className="text-center space-y-8 animate-fade-in">
                    <h1 className="text-4xl font-black text-indigo-700 italic">专驻转拽转 转拽! </h1>
                    <div className="space-y-4">
                      <div className="bg-indigo-50 p-6 rounded-3xl border-2 border-indigo-100">
                        <h3 className="font-bold text-indigo-700 mb-4 text-xl">专 1: 住住 </h3>
                        <div className="grid grid-cols-2 gap-4">
                          <button onClick={() => startNewGame(GameMode.TIMED, DifficultyLevel.BASIC)} className="bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-md"> 憋</button>
                          <button onClick={() => startNewGame(GameMode.RELAXED, DifficultyLevel.BASIC)} className="bg-white text-indigo-600 border-2 border-indigo-600 font-bold py-3 rounded-xl shadow-md">驻砖 </button>
                        </div>
                      </div>
                      <div className="bg-purple-50 p-6 rounded-3xl border-2 border-purple-100">
                        <h3 className="font-bold text-purple-700 mb-4 text-xl">专 2: 转拽 </h3>
                        <div className="grid grid-cols-2 gap-4">
                          <button onClick={() => startNewGame(GameMode.TIMED, DifficultyLevel.ADVANCED)} className="bg-purple-600 text-white font-bold py-3 rounded-xl shadow-md"> 憋</button>
                          <button onClick={() => startNewGame(GameMode.RELAXED, DifficultyLevel.ADVANCED)} className="bg-white text-purple-600 border-2 border-purple-600 font-bold py-3 rounded-xl shadow-md">驻砖 </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {gameState === GameState.PLAYING && currentQuestion && (
                  <div className={`grid grid-cols-1 ${showHelper ? 'lg:grid-cols-2' : ''} gap-8`}>
                    {showHelper && (
                      <div className="bg-yellow-50 border-4 border-yellow-200 rounded-3xl p-4 shadow-inner animate-fade-in order-2 lg:order-1">
                        <div className="flex justify-between items-center mb-2">
                          <p className="font-black text-yellow-800"> 驻 </p>
                          <button onClick={() => setShowHelper(false)} className="text-red-500 font-bold">X</button>
                        </div>
                        <table className="helper-table w-full bg-white" dir="ltr">
                          <thead><tr><th className="bg-gray-100">x</th>{[...Array(10)].map((_, i) => <th key={i} className="bg-indigo-50 font-bold text-indigo-700">{i+1}</th>)}</tr></thead>
                          <tbody>{[...Array(10)].map((_, i) => (
                            <tr key={i}><th className="bg-indigo-50 font-bold text-indigo-700">{i+1}</th>{[...Array(10)].map((_, j) => <td key={j}>{(i+1)*(j+1)}</td>)}</tr>
                          ))}</tbody>
                        </table>
                      </div>
                    )}
                    <div className="space-y-8 text-center order-1 lg:order-2">
                      <div className="flex justify-between items-center mb-4">
                         <span className="bg-indigo-600 text-white px-3 py-1 rounded-full text-xs font-bold">拽: {stats.score}</span>
                         {gameMode === GameMode.TIMED && <span className="text-xl font-bold text-indigo-600">{timer} 憋</span>}
                         <span className="bg-orange-400 text-white px-3 py-1 rounded-full text-xs font-bold">专爪祝: {stats.streak} </span>
                      </div>
                      <div className="bg-indigo-50 rounded-3xl p-8 flex justify-center items-center gap-4 text-5xl md:text-6xl font-black text-indigo-900 shadow-inner" dir="ltr">
                        <span className={currentQuestion.missingPart === 'num1' ? 'text-pink-500' : ''}>{currentQuestion.num1}</span>
                        <span className="text-indigo-300">{currentQuestion.operation}</span>
                        <span className={currentQuestion.missingPart === 'num2' ? 'text-pink-500' : ''}>{currentQuestion.num2}</span>
                        <span>=</span>
                        <span className={currentQuestion.missingPart === 'result' ? 'text-pink-500' : ''}>{currentQuestion.result}</span>
                      </div>
                      <div className="grid grid-cols-2 gap-4" dir="ltr">
                        {currentQuestion.options.map((opt, i) => (
                          <button key={i} onClick={() => handleAnswer(opt)} className="py-6 rounded-2xl text-3xl font-bold bg-white text-indigo-700 border-2 border-indigo-100 shadow-lg hover:bg-indigo-50">{opt}</button>
                        ))}
                      </div>
                      {!showHelper && <button onClick={() => setShowHelper(true)} className="bg-yellow-400 text-yellow-900 font-bold px-4 py-2 rounded-xl text-sm">爪专 注专? </button>}
                      {feedback && (
                        <div className="animate-fade-in">
                          <FeedbackBubble type={feedback.type} message={feedback.message} />
                          {feedback.type === 'error' && <button onClick={() => { setFeedback(null); setIsPaused(false); setCurrentQuestion(generateQuestion(level)); }} className="mt-4 w-full bg-indigo-600 text-white py-3 rounded-xl font-bold">砖 </button>}
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {gameState === GameState.SUMMARY && (
                  <div className="text-center space-y-6">
                    <h2 className="text-3xl font-black text-indigo-700"> ! </h2>
                    <div className="bg-indigo-50 p-6 rounded-2xl">
                      <p className="text-gray-500 text-sm">拽</p>
                      <p className="text-3xl font-bold text-indigo-600">{Math.round((stats.correctAnswers/(stats.totalAnswered||1))*100)}%</p>
                    </div>
                    <button onClick={() => setGameState(GameState.START)} className="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-xl">专 转</button>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
